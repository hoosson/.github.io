<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>JavaScript DOM编程优化 | Hoosson</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="第三章 DOM Scripting DOM  编程">
<meta name="keywords" content="高性能JavaScript学习笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaScript DOM编程优化">
<meta property="og:url" content="https://hoosson.github.io/2019/05/30/高性能JavaScript3/index.html">
<meta property="og:site_name" content="Hoosson">
<meta property="og:description" content="第三章 DOM Scripting DOM  编程">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://7xkj1z.com1.z0.glb.clouddn.com/高性能JavaScript-img3-1.png">
<meta property="og:updated_time" content="2019-05-30T08:54:31.095Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JavaScript DOM编程优化">
<meta name="twitter:description" content="第三章 DOM Scripting DOM  编程">
<meta name="twitter:image" content="http://7xkj1z.com1.z0.glb.clouddn.com/高性能JavaScript-img3-1.png">
  
    <link rel="alternative" href="/atom.xml" title="Hoosson" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/qqhead.jpg">
  
  <link rel="stylesheet" href="/css/style.css">
  
<script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

  
<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-85415703-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

  
</head></html>

<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/qqhead.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/"></a></h1>
		</hgroup>

		
		<p class="header-subtitle">Bboy Xun</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
					        
								<a class="mail" target="_blank" href="#" title="mail">mail</a>
					        
								<a class="qq" target="_blank" href="#" title="qq">qq</a>
					        
								<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/Electron/" style="font-size: 10px;">Electron</a> <a href="/tags/hexo/" style="font-size: 13.33px;">hexo</a> <a href="/tags/兼容性/" style="font-size: 16.67px;">兼容性</a> <a href="/tags/没事瞎扯/" style="font-size: 10px;">没事瞎扯</a> <a href="/tags/高性能JavaScript学习笔记/" style="font-size: 20px;">高性能JavaScript学习笔记</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/smackgg/hexo-theme-smackdown">smackdown</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/qqhead.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<p class="header-subtitle">Bboy Xun</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
						<a class="mail" target="_blank" href="#" title="mail">mail</a>
			        
						<a class="qq" target="_blank" href="#" title="qq">qq</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-高性能JavaScript3" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/05/30/高性能JavaScript3/" class="article-date">
  	<time datetime="2019-05-30T02:20:11.000Z" itemprop="datePublished">2019-05-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      JavaScript DOM编程优化
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/高性能JavaScript学习笔记/">高性能JavaScript学习笔记</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/高性能JavaScript-3/">高性能JavaScript-3</a>
	</div>


        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>第三章 DOM Scripting DOM  编程<br><a id="more"></a></p>
<h1 id="第三章-DOM-Scripting-DOM-编程"><a href="#第三章-DOM-Scripting-DOM-编程" class="headerlink" title="第三章 DOM Scripting DOM  编程"></a><strong>第三章 DOM Scripting DOM  编程</strong></h1><p>　　回去看了一下前面两章的内容，发现写的内容都很多，但是过于繁琐，基本与原文解释的内容差不多，在后面的文章中，我将更多的写自己的理解，而不是更多的原文内容，如果对优化很感兴趣，可以详细的看一下《高性能JavaScript》这本书。在每章结束时，依旧有总结。</p>
<hr>
<p>　　在这章主要讨论以下三个问题。</p>
<ul>
<li>1.访问和修改 DOM 元素。</li>
<li>2.修改 DOM 元素的样式，造成重绘和重新排版。</li>
<li><p>3.通过 DOM 事件处理用户响应。<br>  　　DOM 在浏览器中主要是用来操作 HTML 文档的。它天生就很慢，当你每次访问 DOM 时都需要耗费性能，这就好比每次 ECMAScript 需要访问 DOM 时，你需要过桥，交一次“过桥费”。所以，当你操作 DOM 次数越多，费用就越高。看一下下面这个例子：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">innerHTMLLoop</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> count = <span class="number">0</span>; count &lt; <span class="number">15000</span>; count++) &#123;</span><br><span class="line">		<span class="built_in">document</span>.getElementById(<span class="string">'here'</span>).innerHTML += <span class="string">'a'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  　　这个例子中，你每次循环都要访问DOM两次，一次是读取innerHTML，另一次是写入它。再看一下下面的改进版本。</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">innerHTMLLoop2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> content = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> count = <span class="number">0</span>; count &lt; <span class="number">15000</span>; count++) &#123;</span><br><span class="line">		content += <span class="string">'a'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">document</span>.getElementById(<span class="string">'here'</span>).innerHTML += content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>　　<strong>使用局部变量存储更新后的内容，在循环结束时一次性写入，如果循环非常大，你可能会发现性能会比之前快了几百倍。</strong></p>
<p>　　还有一种优化方式，是用 innerHTML 来代替纯DOM ，innerHTML 会比纯 DOM方法快一点，下面两个例子分别建1000行的表：<br>innerHTML方法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tableInnerHTML</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> i, h = [<span class="string">'&lt;table border="1" width="100%"&gt;'</span>];</span><br><span class="line">	h.push(<span class="string">'&lt;thead&gt;'</span>);</span><br><span class="line">	h.push(<span class="string">'&lt;tr&gt;&lt;th&gt;id&lt;\/th&gt;&lt;th&gt;yes?&lt;\/th&gt;&lt;th&gt;name&lt;\/th&gt;&lt;th&gt;url&lt;\/th&gt;&lt;th&gt;action&lt;\/th&gt;&lt;\/tr&gt;'</span>);</span><br><span class="line">	h.push(<span class="string">'&lt;\/thead&gt;'</span>);</span><br><span class="line">	h.push(<span class="string">'&lt;tbody&gt;'</span>);</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= <span class="number">1000</span>; i++) &#123;</span><br><span class="line">	h.push(<span class="string">'&lt;tr&gt;&lt;td&gt;'</span>);</span><br><span class="line">	h.push(i);</span><br><span class="line">	h.push(<span class="string">'&lt;\/td&gt;&lt;td&gt;'</span>);</span><br><span class="line">	h.push(<span class="string">'And the answer is... '</span> + (i % <span class="number">2</span> ? <span class="string">'yes'</span> : <span class="string">'no'</span>));</span><br><span class="line">	h.push(<span class="string">'&lt;\/td&gt;&lt;td&gt;'</span>);</span><br><span class="line">	h.push(<span class="string">'my name is #'</span> + i);</span><br><span class="line">	h.push(<span class="string">'&lt;\/td&gt;&lt;td&gt;'</span>);</span><br><span class="line">	h.push(<span class="string">'&lt;a href="http://example.org/'</span> + i + <span class="string">'.html"&gt;http://example.org/'</span> + i + <span class="string">'.html&lt;\/a&gt;'</span>);</span><br><span class="line">	h.push(<span class="string">'&lt;\/td&gt;&lt;td&gt;'</span>);</span><br><span class="line">	h.push(<span class="string">'&lt;ul&gt;'</span>);</span><br><span class="line">	h.push(<span class="string">' &lt;li&gt;&lt;a href="edit.php?id='</span> + i + <span class="string">'"&gt;edit&lt;\/a&gt;&lt;\/li&gt;'</span>);</span><br><span class="line">	h.push(<span class="string">' &lt;li&gt;&lt;a href="delete.php?id="'</span> + i + <span class="string">'-id001"&gt;delete&lt;\/a&gt;&lt;\/li&gt;'</span>);</span><br><span class="line">	h.push(<span class="string">'&lt;\/ul&gt;'</span>);</span><br><span class="line">	h.push(<span class="string">'&lt;\/td&gt;'</span>);</span><br><span class="line">	h.push(<span class="string">'&lt;\/tr&gt;'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	h.push(<span class="string">'&lt;\/tbody&gt;'</span>);</span><br><span class="line">	h.push(<span class="string">'&lt;\/table&gt;'</span>);</span><br><span class="line">	<span class="built_in">document</span>.getElementById(<span class="string">'here'</span>).innerHTML = h.join(<span class="string">''</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>如果使用 DOM 方法创建同样的表，代码有些冗长：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tableDOM</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> i, table, thead, tbody, tr, th, td, a, ul, li;</span><br><span class="line">	tbody = <span class="built_in">document</span>.createElement (<span class="string">'tbody'</span>);</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= <span class="number">1000</span>; i++) &#123;</span><br><span class="line">		tr = <span class="built_in">document</span>.createElement (<span class="string">'tr'</span>);</span><br><span class="line">		td = <span class="built_in">document</span>.createElement (<span class="string">'td'</span>);</span><br><span class="line">		td.appendChild(<span class="built_in">document</span>.createTextNode((i % <span class="number">2</span>) ? <span class="string">'yes'</span> : <span class="string">'no'</span>));</span><br><span class="line">		tr.appendChild(td);</span><br><span class="line">		td = <span class="built_in">document</span>.createElement (<span class="string">'td'</span>);</span><br><span class="line">		td.appendChild(<span class="built_in">document</span>.createTextNode(i));</span><br><span class="line">		tr.appendChild(td);</span><br><span class="line">		td = <span class="built_in">document</span>.createElement (<span class="string">'td'</span>);</span><br><span class="line">		td.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">'my name is #'</span> + i));</span><br><span class="line">		tr.appendChild(td);</span><br><span class="line">		a = <span class="built_in">document</span>.createElement (<span class="string">'a'</span>);</span><br><span class="line">		a.setAttribute(<span class="string">'href'</span>, <span class="string">'http://example.org/'</span> + i + <span class="string">'.html'</span>);</span><br><span class="line">		a.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">'http://example.org/'</span> + i + <span class="string">'.html'</span>));</span><br><span class="line">		td = <span class="built_in">document</span>.createElement (<span class="string">'td'</span>);</span><br><span class="line">		td.appendChild(a);</span><br><span class="line">		tr.appendChild(td);</span><br><span class="line">		ul = <span class="built_in">document</span>.createElement (<span class="string">'ul'</span>);</span><br><span class="line">		a = <span class="built_in">document</span>.createElement (<span class="string">'a'</span>);</span><br><span class="line">		a.setAttribute(<span class="string">'href'</span>, <span class="string">'edit.php?id='</span> + i);</span><br><span class="line">		a.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">'edit'</span>));</span><br><span class="line">		li = <span class="built_in">document</span>.createElement (<span class="string">'li'</span>);</span><br><span class="line">		li.appendChild(a);</span><br><span class="line">		ul.appendChild(li);</span><br><span class="line">		a = <span class="built_in">document</span>.createElement (<span class="string">'a'</span>);</span><br><span class="line">		a.setAttribute(<span class="string">'href'</span>, <span class="string">'delete.php?id='</span> + i);</span><br><span class="line">		a.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">'delete'</span>));</span><br><span class="line">		li = <span class="built_in">document</span>.createElement (<span class="string">'li'</span>);</span><br><span class="line">		li.appendChild(a);</span><br><span class="line">		ul.appendChild(li);</span><br><span class="line">		td = <span class="built_in">document</span>.createElement (<span class="string">'td'</span>);</span><br><span class="line">		td.appendChild(ul);</span><br><span class="line">		tr.appendChild(td);</span><br><span class="line">		tbody.appendChild(tr);</span><br><span class="line">	&#125;</span><br><span class="line">	tr = <span class="built_in">document</span>.createElement (<span class="string">'tr'</span>);</span><br><span class="line">	th = <span class="built_in">document</span>.createElement (<span class="string">'th'</span>);</span><br><span class="line">	th.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">'yes?'</span>));</span><br><span class="line">	tr.appendChild(th);</span><br><span class="line">	th = <span class="built_in">document</span>.createElement (<span class="string">'th'</span>);</span><br><span class="line">	th.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">'id'</span>));</span><br><span class="line">	tr.appendChild(th);</span><br><span class="line">	th = <span class="built_in">document</span>.createElement (<span class="string">'th'</span>);</span><br><span class="line">	th.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">'name'</span>));</span><br><span class="line">	tr.appendChild(th);</span><br><span class="line">	th = <span class="built_in">document</span>.createElement(<span class="string">'th'</span>);</span><br><span class="line">	th.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">'url'</span>));</span><br><span class="line">	tr.appendChild(th);</span><br><span class="line">	th = <span class="built_in">document</span>.createElement(<span class="string">'th'</span>);</span><br><span class="line">	th.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">'action'</span>));</span><br><span class="line">	tr.appendChild(th);</span><br><span class="line">	thead = <span class="built_in">document</span>.createElement(<span class="string">'thead'</span>);</span><br><span class="line">	thead.appendChild(tr);</span><br><span class="line">	table = <span class="built_in">document</span>.createElement(<span class="string">'table'</span>);</span><br><span class="line">	table.setAttribute(<span class="string">'border'</span>, <span class="number">1</span>);</span><br><span class="line">	table.setAttribute(<span class="string">'width'</span>, <span class="string">'100%'</span>);</span><br><span class="line">	table.appendChild(thead);</span><br><span class="line">	table.appendChild(tbody);</span><br><span class="line">	<span class="built_in">document</span>.getElementById(<span class="string">'here'</span>).appendChild(table);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>注意：在 webkit内核的浏览器中，DOM的方法更快。所以，决定使用哪种方法更快取决于你的浏览器。如果在一个性能苛刻的操作中更新一大块 HTML 页面，innerHTML 在大多数浏览器中执行更快。但对于大多数日常操作而言，其差异并不大，所以你应当根据代码可读性，可维护性，团队习惯，代码风格来<br>综合决定采用哪种方法。</p>
</blockquote>
<p>　　上面说到的建1000行表也可以用节点克隆来解决，但是性能提高的不是很明显，这里不再细说。</p>
<hr>
<p>HTML 集合是用于存放 DOM 节点引用的类数组对象。下列函数的返回值就是一个集合：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementsByName()</span><br><span class="line"><span class="built_in">document</span>.getElementsByClassName()</span><br><span class="line"><span class="built_in">document</span>.getElementsByTagName()</span><br><span class="line"><span class="built_in">document</span>.images</span><br><span class="line"><span class="built_in">document</span>.links</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>这里有一点需要优化的就是集合的遍历，集合的遍历是没有数组的遍历速度快的，所以尽量的将HTML集合拷贝到一个数组中，再进行遍历，看一下下面的例子：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toArray</span>(<span class="params">coll</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, a = [], len = coll.length; i &lt; len; i++) &#123;</span><br><span class="line">		a[i] = coll[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> coll = <span class="built_in">document</span>.getElementsByTagName_r(<span class="string">'div'</span>);</span><br><span class="line"><span class="keyword">var</span> arr = toArray(coll)</span><br><span class="line"><span class="comment">//比较下面两个函数的快慢。</span></span><br><span class="line"><span class="comment">//slower</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loopCollection</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> count = <span class="number">0</span>; count &lt; coll.length; count++) &#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// faster</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loopCopiedArray</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> count = <span class="number">0</span>; count &lt; arr.length; count++) &#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个例子中还有很多的地方可以优化，比如“.length”，无论是调用数组还是集合的length属性，都意味着每次都要重新运行查询过程。所以，最好的办法是将length属性缓存到局部变量中，同样的，如果再循环中多次访问同一个集合元素，也用局部变量缓存它：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">collectionNodesLocal</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> coll = <span class="built_in">document</span>.getElementsByTagName_r(<span class="string">'div'</span>),</span><br><span class="line">	len = coll.length,</span><br><span class="line">	name = <span class="string">''</span>,</span><br><span class="line">	el = <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> count = <span class="number">0</span>; count &lt; len; count++) &#123;</span><br><span class="line">		el = coll[count];</span><br><span class="line">		name = el.nodeName;</span><br><span class="line">		name = el.nodeType;</span><br><span class="line">		name = el.tagName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> name;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>这样才能让你的DOM访问更有效率，节省性能的开销。</p>
<hr>
<p>在抓取节点的时候，因为节点的类型有很多，如注释节点和文本节点等。而我们常用的是元素节点，所以，此时选择只表示元素节点的DOM属性:<br><img src="http://7xkj1z.com1.z0.glb.clouddn.com/高性能JavaScript-img3-1.png" alt="只表示元素节点的 DOM 属性（HTML 标签）和表示所有节点的属性"></p>
<p>使用CSS选择器尽量使用浏览器原生的DOM函数，如： querySelectorAll()、querySelector等。</p>
<hr>
<p>尽量阻止重排现象，否则会导致你的性能大减。在下述情况中会发生重排版：</p>
<ul>
<li>添加或删除可见的 DOM 元素.</li>
<li>元素位置改变.</li>
<li>元素尺寸改变（因为边距，填充，边框宽度，宽度，高度等属性改变）</li>
<li>内容改变，例如，文本改变或图片被另一个不同尺寸的所替代</li>
<li>最初的页面渲染</li>
<li>浏览器窗口改变尺寸</li>
</ul>
<p>　　根据改变的性质，渲染树上或大或小的一部分需要重新计算。某些改变可导致重排版整个页面：例如，当一个滚动条出现时。</p>
<p>　　大多数浏览器通过队列化修改和批量显示优化重排版过程。然而，你可<br>能（经常不由自主地）强迫队列刷新并要求所有计划改变的部分立刻应用。获取布局信息的操作将导致刷新队列动作，这意味着使用了下面这些方法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">offsetTop, offsetLeft, offsetWidth, offsetHeight</span><br><span class="line">scrollTop, scrollLeft, scrollWidth, scrollHeight</span><br><span class="line">clientTop, clientLeft, clientWidth, clientHeight</span><br><span class="line">getComputedStyle() (currentStyle <span class="keyword">in</span> IE)（在 IE 中此函数称为 currentStyle)</span><br></pre></td></tr></table></figure></p>
<p>在改变风格的过程中，最好不要使用前面列出的那些属性。任何一个访问都将刷新渲染队列，即使你正在获取那些最近未发生改变的或者与最新的改变无关的布局信息。</p>
<p>在改变CSS属性时，尽量将所有改变合并在一起执行。只修改一次DOM。可以通过cssText来实现：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> el = <span class="built_in">document</span>.getElementById(<span class="string">'mydiv'</span>);</span><br><span class="line">el.style.cssText = <span class="string">'border-left: 1px; border-right: 2px; padding: 5px;'</span>;</span><br><span class="line"></span><br><span class="line">下面例子是常见的写法，与上面的例子相比慢了很多。</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> el = <span class="built_in">document</span>.getElementById(<span class="string">'mydiv'</span>);</span><br><span class="line">el.style.borderLeft = <span class="string">'1px'</span>;</span><br><span class="line">el.style.borderRight = <span class="string">'2px'</span>;</span><br><span class="line">el.style.padding = <span class="string">'5px'</span>;</span><br></pre></td></tr></table></figure></p>
<p>减少重排的方法一：<br>　　从文档流中摘除该元素–&gt;对其应用多重改变–&gt;将元素带回文档中<br>摘除元素可以用以下方法来进行：</p>
<ul>
<li>隐藏元素，进行修改，然后再显示它。</li>
<li>使用一个文档片断在已存 DOM 之外创建一个子树，然后将它拷贝到文档中。</li>
<li><p>将原始元素拷贝到一个脱离文档的节点中，修改副本，然后覆盖原始元素。<br>减少重排的方法二：<br>　　在文档之外创建并更新一个文档片断，然后将它附加在原始列表上。文档片断是一个轻量级的 document 对象，它被设计专用于更新、移动节点之类的任务。文档片断一个便利的语法特性是当你向节点附加一个片断时，实际添加的是文档片断的子节点群，而不是片断自己。<br>减少重排的方法三：<br>　　创建要更新节点的副本，然后在副本上操作，最后用新节点覆盖老节点。</p>
</li>
<li><p>大量的使用hover会降低反应速度，在IE8中更显著。</p>
</li>
<li><p>尽量使用时间托管来绑定事件，来提高性能。</p>
</li>
</ul>
<hr>
<h1 id="Summary-总结"><a href="#Summary-总结" class="headerlink" title="Summary 总结"></a>Summary 总结</h1><hr>
<p>　　DOM 访问和操作是现代网页应用中很重要的一部分。 但每次你通过桥梁从 ECMAScript 岛到达 DOM 岛时，都会被收取“过桥费”。为减少 DOM 编程中的性能损失，请牢记以下几点：</p>
<ul>
<li>最小化 DOM 访问，在 JavaScript 端做尽可能多的事情。</li>
<li>在反复访问的地方使用局部变量存放 DOM 引用.</li>
<li>小心地处理 HTML 集合，因为他们表现出“存在性”，总是对底层文档重新查询。将集合的 length 属性缓存到一个变量中，在迭代中使用这个变量。如果经常操作这个集合，可以将集合拷贝到数组中。</li>
<li>如果可能的话，使用速度更快的 API，诸如 querySelectorAll()和 firstElementChild。</li>
<li>注意重绘和重排版；批量修改风格，离线操作 DOM 树，缓存并减少对布局信息的访问。</li>
<li>动画中使用绝对坐标，使用拖放代理。</li>
<li>使用事件托管技术最小化事件句柄数量。</li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/05/30/浅谈BFC实际应用/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          浅谈BFC的实际应用
        
      </div>
    </a>
  
  
    <a href="/2019/05/30/高性能JavaScript6/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">JavaScript 响应接口的优化</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>


<div class="ds-share share" data-thread-key="高性能JavaScript3" data-title="JavaScript DOM编程优化" data-url="https://hoosson.github.io/2019/05/30/高性能JavaScript3/" data-images="/img/qqhead.jpg" data-content="JavaScript DOM编程优化">
    <div class="ds-share-inline">
      <ul class="ds-share-icons-16">
      	<li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
        <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
        <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
        <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
        <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
      </ul>
      <div class="ds-share-icons-more">
      </div>
    </div>
 </div>
 





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2019 Hoosson
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>



  </div>
  

	<script type="text/javascript" src="/js/clicklove.js"></script> 


</body>
</html>